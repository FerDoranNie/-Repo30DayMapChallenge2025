<!DOCTYPE html>
<html lang="en">
<head>
  <title>Display buildings in 3D</title>
  <meta property="og:description" content="Use extrusions to display buildings' height in 3D." />
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.css' />
  <script src='https://unpkg.com/maplibre-gl@5.13.0/dist/maplibre-gl.js'></script>
  <style>
    body { margin: 0; padding: 0; }
    html, body, #map { height: 100%; }
    #menu {
        position: absolute;
        background: #fff;
        padding: 10px;
        font-family: 'Open Sans', sans-serif;
        top: 10px;
        left: 10px;
        z-index: 1;
        border-radius: 3px;
    }
    #menu button {
        display: block;
        width: 100%;
        margin-bottom: 5px;
        padding: 5px 10px;
        border: 1px solid #ccc;
        background: #f9f9f9;
        cursor: pointer;
    }
    #menu button:last-child {
        margin-bottom: 0;
    }
    #menu button:hover {
        background: #e9e9e9;
    }
    h1 {
            font-weight: 100;
            color: #1581BF;
            font-size: 1.8em;
            text-align: center;
            max-width: 90%;
            z-index: 10;
            pointer-events: none;
    }
    h2 {
            font-weight: 100;
            color: #1581BF;
            font-size: 1.2em;
            text-align: center;
            max-width: 90%;
            z-index: 10;
            pointer-events: none;
    }
    h3 {
            font-weight: 100;
            color: #1581BF;
            font-size: 1em;
            text-align: center;
            max-width: 90%;
            z-index: 10;
            pointer-events: none;
    }
    /* Mobile-first responsive styles */
    @media screen and (max-width: 768px) {
        h1 { font-size: 1.2em; }
        h2 { font-size: 0.9em; }
        h3 { font-size: 0.8em; }
        #menu {
            padding: 5px;
            top: 5px;
            left: 5px;
        }
        #menu button {
            padding: 4px 8px;
            font-size: 0.8em;
        }
    }

</style>
</head>
<body>
<h1>¿Cómo se ven los contornos de edificios en las principales ciudades latinoamericanas?</h1>
<h1>#30DayMapChallenge Día 23 </h1>
<h2>Fuente: OpenStreetMap, 2025</h2>
<h3>Autor: Fernando Dorantes Nieto</h3>

<div id="menu"></div>
<div id="map"></div>
<script>
  // Adjust initial zoom for mobile devices
  const initialZoom = window.innerWidth < 768 ? 15.5 : 16.5;

  const map = new maplibregl.Map({
      style: `https://tiles.openfreemap.org/styles/bright`,
      center:[-99.1331994135622, 19.432899069952587], 
      zoom: initialZoom,
      pitch: 45,
      bearing: -17.6,
      container: 'map',
      canvasContextAttributes: {antialias: true}
  });

  const cities = {
      'Ciudad de México, México': [-99.1332, 19.4326],
      'Guadalajara, México': [-103.34695225787775, 20.676180959963535], 
      'Monterrey, México': [-100.32121835887814, 25.67631592674986],
      'Puebla, México': [-98.19804283342509, 19.043617488476496],
      'Bogotá, Colombia': [-74.08221038195512, 4.636085370855202],
      'Sao Paulo, Brasil': [-46.6333, -23.5505],
      'Rio de Janeiro, Brasil': [-43.1729, -22.9068],
      'Santiago de Chile, Chile': [-70.6693, -33.4489],
      'Buenos Aires, Argentina': [-58.3816, -34.6037],
      'Lima, Perú': [-77.03163591416575, -12.047860426262124],
      'Caracas, Venezuela': [-66.91301702736871, 10.502263508801475],
      'Quito, Ecuador': [-78.51172451444337, -0.2347660782449291]

  };

  const menu = document.getElementById('menu');
  for (const cityName in cities) {
      const button = document.createElement('button');
      button.textContent = cityName;
      button.addEventListener('click', () => {
          map.flyTo({ center: cities[cityName], zoom: 16.5, speed: 0.2 });
      });
      menu.appendChild(button);
  }

  // data from OpenStreetMap.
  map.on('load', () => {
      const layers = map.getStyle().layers;

      let labelLayerId;
      for (let i = 0; i < layers.length; i++) {
          if (layers[i].type === 'symbol' && layers[i].layout['text-field']) {
              labelLayerId = layers[i].id;
              break;
          }
      }

      map.addSource('openfreemap', {
          url: `https://tiles.openfreemap.org/planet`,
          type: 'vector',
      });

      map.addLayer(
          {
              'id': '3d-buildings',
              'source': 'openfreemap',
              'source-layer': 'building',
              'type': 'fill-extrusion',
              'minzoom': 15,
              'filter': ['!=', ['get', 'hide_3d'], true],
              'paint': {
                  'fill-extrusion-color': [
                      'interpolate',
                      ['linear'],
                      ['get', 'render_height'], 0, 'lightgray', 200, 'royalblue', 400, 'lightblue'
                  ],
                  'fill-extrusion-height': [
                      'interpolate',
                      ['linear'],
                      ['zoom'],
                      15,
                      0,
                      16,
                      ['get', 'render_height']
                  ],
                  'fill-extrusion-base': ['case',
                      ['>=', ['get', 'zoom'], 16],
                      ['get', 'render_min_height'], 0
                  ]
              }
          },
          labelLayerId
      );
  });
</script>
</body>
</html>